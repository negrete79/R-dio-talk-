<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Conexão - Espectador</title>
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #333; color: #fff; text-align: center; padding: 20px; }
        input { padding: 10px; font-size: 16px; width: 80%; margin-bottom: 10px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #status { font-size: 20px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Teste de Conexão (Espectador)</h1>
    <p>Digite o ID que apareceu no outro dispositivo:</p>
    <input type="text" id="id-input" placeholder="test-xxxxxxxx">
    <br>
    <button id="connect-btn">Conectar</button>
    <div id="status">Aguardando...</div>

    <script>
        const idInput = document.getElementById('id-input');
        const connectBtn = document.getElementById('connect-btn');
        const statusDiv = document.getElementById('status');
        
        const peer = new Peer();

        peer.on('open', () => {
            statusDiv.textContent = 'Pronto para conectar. Digite o ID e clique em Conectar.';
            console.log('Espectador inicializado.');
        });

        peer.on('error', (err) => {
            statusDiv.textContent = `❌ ERRO: ${err.type} - ${err.message}`;
            console.error('Erro no Peer:', err);
        });

        connectBtn.onclick = () => {
            const remoteId = idInput.value.trim();
            if (!remoteId) {
                alert('Por favor, digite um ID.');
                return;
            }
            statusDiv.textContent = `Tentando conectar com ${remoteId}...`;
            
            const conn = peer.connect(remoteId);

            conn.on('open', () => {
                statusDiv.textContent = '✅ CONECTADO! Conexão bem-sucedida.';
                console.log('Conectado com: ' + conn.peer);
                // Envia uma mensagem de teste
                conn.send('Olá! Esta é uma mensagem de teste.');
            });

            conn.on('error', (err) => {
                statusDiv.textContent = `❌ ERRO DE CONEXÃO: ${err.type}`;
                console.error('Erro na conexão:', err);
            });
        };
    </script>
</body>
</html>